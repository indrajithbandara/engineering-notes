4. Организац3ия совместной работы пользователей

Как уже было отмечено ранее, в состав установочного пакета Expect включены уже готовые скрипты, предназначенные для выполнения задач администрирования. Один из этих скриптов – kibitz – предоставляет весьма любопытные возможности.

Дон Либис с изрядной долей юмора дал такое имя (в переводе с английского kibitz – вмешиваться в чужие дела; давать непрошеные советы) скрипту, который позволяет двум или даже нескольким пользователям одновременно работать с одной программой: это может быть командная оболочка, текстовый редактор и т.д. Ограничение только одно – это должны быть программы с символьным (текстовым) интерфейсом. Запуск программ с графическим интерфейсом возможен, но при этом не гарантируется нормальный вид и поведение таких программ. Впрочем, это ограничение устраняется с помощью ещё одного скрипта xkibitz, который позволяет нормально работать с X-программами, а кроме того, обеспечивает динамическое подключение и отключение пользователей во время работы.

Для того чтобы начать работу, пользователь (назовём его user1) запускает скрипт, передавая ему в качестве аргумента имя другого пользователя, с которым он намеревается взаимодействовать (пусть это будет user2):

kibitz user2

При этом активизируется новый экземпляр командной оболочки (или какая-либо другая программа, которую можно задать в командной строке), а пользователю user2 предлагается также выполнить скрипт kibitz. В приглашение включается уникальный идентификатор для того, чтобы избежать конфликтов с другими сеансами kibitz. В действительности этот идентификатор представляет не что иное, как просто идентификатор исходного процесса kibitz. Второй пользователь получает приблизительно такое сообщение:

Can we talk? Run: kibitz -4077
EOF

После того как user2 выполнит указанную в сообщении команду (kibitz -4077), все нажатия клавиш обоих пользователей становятся вводом для общей командной оболочки. Соответственно, оба пользователя получают вывод оболочки.

Для того чтобы завершить сеанс kibitz, достаточно просто выйти из "совместной" командной оболочки, нажав клавиши Ctrl-D или введя команду exit. После выхода одного из пользователей происходит автоматический выход из оболочки и второго пользователя, в результате чего сеанс kibitz завершается.

В сетевой среде, когда вызываемый пользователь работает на другом хосте, команда инициализации сеанса kibitz выглядит следующим образом:

kibitz user2@host02

Канал связи создаётся с помощью утилиты rlogin. Если удалённый компьютер запрашивает пароль, то kibitz перехватывает этот запрос и предлагает вызывающему пользователю ввести требуемый пароль. Все прочие подробности установления соединения скрыты от пользователей.

После установления соединения и инициализации сеанса kibitz вторым пользователем всё выглядит так, как если бы оба пользователя работали на одном компьютере. Завершение сеанса производится точно так же, как описано выше.

Если необходимо организовать сеанс с участием более двух пользователей, то можно воспользоваться таким вариантом команды:

kibitz user2@host02 kibitz user3@host03 kibitz user4@host04

Такой "массовый сеанс" вполне пригоден, например, для обучения и для консультаций, когда опытный пользователь наглядно показывает начинающим, как выполняются различные операции, следит за их действиями, отвечает на вопросы и т.п. Разумеется, для организации подобного сеанса необходимо, чтобы на всех хостах-участниках был установлен пакет программ Expect.

Запуск консольного текстового редактора в kibitz-сеансе позволяет провести "интерактивное совещание" с ведением протокола или организовать совместное редактирование документов.

